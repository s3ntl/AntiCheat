using AntiCheat.Signals;
using AntiCheat.Utils;
using HarmonyLib;

namespace AntiCheat.Patches
{
    [HarmonyPatch(typeof(Aircraft), "UserCode_CmdSlingLoadAttachment_-82313074")]
    public class InterceptHookExploiting
    {
        public static bool Prefix(Aircraft __instance, Unit slingLoadUnit, SlingloadHook.DeployState state)
        {
            
            if (__instance.Player != null && slingLoadUnit is Aircraft)
            {
                Aircraft target = slingLoadUnit as Aircraft;
                if (target.Player != null && SlingloadHook.DeployState.Retracting == state)
                {

                    Plugin.logger.LogError($"Player {__instance.Player.PlayerName} used slingload exploit on {target.Player.PlayerName}");
                    //EventBus.Instance.Invoke<HookExploitUsedSignal>(new HookExploitUsedSignal(target.Player, __instance.Player));
                    return false;
                }
            }
            return true;
        }
    }
}
